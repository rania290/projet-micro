---
# Source: social-network/templates/serviceaccounts/prometheus-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: social-network-prometheus
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: prometheus
---
# Source: social-network/templates/secrets/grafana-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: social-network-grafana-secret
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: grafana
type: Opaque
data:
  admin-password: "YWRtaW4xMjM="
---
# Source: social-network/templates/configmaps/grafana-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: social-network-grafana-config
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: grafana
data:
  prometheus.yml: |
    apiVersion: 1
    datasources:
    - name: Prometheus
      type: prometheus
      access: proxy
      url: http://social-network-prometheus:9090
      isDefault: true
      editable: true
---
# Source: social-network/templates/configmaps/prometheus-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: social-network-prometheus-config
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: prometheus
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    rule_files:
      # - "first_rules.yml"
      # - "second_rules.yml"

    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']

      - job_name: 'posts-service'
        metrics_path: '/metrics'
        static_configs:
          - targets: ['social-network-posts-service:3020']

      - job_name: 'graphql-service'
        metrics_path: '/metrics'
        static_configs:
          - targets: ['social-network-graphql-service:4000']

      - job_name: 'chat-service'
        metrics_path: '/metrics'
        static_configs:
          - targets: ['social-network-chat-service:8080']

      - job_name: 'mongodb'
        metrics_path: '/metrics'
        static_configs:
          - targets: ['social-network-mongodb:9216']

      - job_name: 'kafka'
        metrics_path: '/metrics'
        static_configs:
          - targets: ['social-network-kafka:9308']
---
# Source: social-network/templates/pvcs.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: social-network-mongodb-pvc
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
---
# Source: social-network/templates/pvcs.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: social-network-kafka-pvc
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
---
# Source: social-network/templates/pvcs.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: social-network-zookeeper-pvc
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
---
# Source: social-network/templates/services/chat-service-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: social-network-chat-service
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: chat-service
spec:
  type: ClusterIP
  ports:
  - port: 50051
    targetPort: 50051
    protocol: TCP
    name: grpc
  - port: 8080
    targetPort: 8080
    protocol: TCP
    name: metrics
  selector:
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/component: chat-service
---
# Source: social-network/templates/services/grafana-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: social-network-grafana
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: grafana
spec:
  type: LoadBalancer
  ports:
  - port: 3000
    targetPort: 3000
    protocol: TCP
    name: http
  selector:
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/component: grafana
---
# Source: social-network/templates/services/graphql-service-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: social-network-graphql-service
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: graphql-service
spec:
  type: LoadBalancer
  ports:
  - port: 4000
    targetPort: 4000
    protocol: TCP
    name: http
  selector:
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/component: graphql-service
---
# Source: social-network/templates/services/kafka-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: social-network-kafka
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: kafka
spec:
  type: ClusterIP
  ports:
  - port: 9092
    targetPort: 9092
    protocol: TCP
    name: kafka
  - port: 9308
    targetPort: 9308
    protocol: TCP
    name: metrics
  selector:
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/component: kafka
---
# Source: social-network/templates/services/mongodb-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: social-network-mongodb
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: mongodb
spec:
  type: ClusterIP
  ports:
  - port: 27017
    targetPort: 27017
    protocol: TCP
    name: mongodb
  - port: 9216
    targetPort: 9216
    protocol: TCP
    name: metrics
  selector:
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/component: mongodb
---
# Source: social-network/templates/services/posts-service-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: social-network-posts-service
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: posts-service
spec:
  type: ClusterIP
  ports:
  - port: 3020
    targetPort: 3020
    protocol: TCP
    name: http
  selector:
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/component: posts-service
---
# Source: social-network/templates/services/prometheus-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: social-network-prometheus
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: prometheus
spec:
  type: ClusterIP
  ports:
  - port: 9090
    targetPort: 9090
    protocol: TCP
    name: http
  selector:
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/component: prometheus
---
# Source: social-network/templates/services/zookeeper-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: social-network-zookeeper
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: zookeeper
spec:
  type: ClusterIP
  ports:
  - port: 2181
    targetPort: 2181
    protocol: TCP
    name: zookeeper
  selector:
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/component: zookeeper
---
# Source: social-network/templates/deployments/chat-service-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-chat-service
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: chat-service
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: chat-service
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: chat-service
    spec:
      containers:
      - name: chat-service
        image: rania290/projet-micro-chat-service:local
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 50051
        - containerPort: 8080
        env:
        - name: KAFKA_BROKERS
          value: "social-network-kafka:9092"
        - name: MONGODB_URI
          value: "mongodb://admin:password@social-network-mongodb:27017/social-network?authSource=admin"
        - name: CHAT_SERVICE_PORT
          value: "50051"
        - name: CHAT_SERVICE_METRICS_PORT
          value: "8080"
        resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        livenessProbe:
          tcpSocket:
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 20
        readinessProbe:
          tcpSocket:
            port: 8080
          initialDelaySeconds: 15
          periodSeconds: 10
---
# Source: social-network/templates/deployments/grafana-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-grafana
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: grafana
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: grafana
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: grafana
    spec:
      containers:
      - name: grafana
        image: grafana/grafana:10.1.0
        ports:
        - containerPort: 3000
        env:
        - name: GF_SECURITY_ADMIN_PASSWORD
          valueFrom:
            secretKeyRef:
              name: social-network-grafana-secret
              key: admin-password
        volumeMounts:
        - name: grafana-storage
          mountPath: /var/lib/grafana
        - name: grafana-config
          mountPath: /etc/grafana/provisioning/datasources
          readOnly: true
        resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        livenessProbe:
          httpGet:
            path: /api/health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /api/health
            port: 3000
          initialDelaySeconds: 5
          periodSeconds: 5
      volumes:
      - name: grafana-storage
        emptyDir: {}
      - name: grafana-config
        configMap:
          name: social-network-grafana-config
---
# Source: social-network/templates/deployments/graphql-service-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-graphql-service
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: graphql-service
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: graphql-service
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: graphql-service
    spec:
      containers:
      - name: graphql-service
        image: rania290/projet-micro-graphql-service:local
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 4000
        env:
        - name: POSTS_SERVICE_URL
          value: "http://social-network-posts-service:3020"
        - name: GRAPHQL_SERVICE_PORT
          value: "4000"
        - name: MONGODB_URI
          value: "mongodb://admin:password@social-network-mongodb:27017/social-network?authSource=admin"
        - name: KAFKA_BROKERS
          value: "social-network-kafka:9092"
        resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        livenessProbe:
          httpGet:
            path: /.well-known/apollo/server-health
            port: 4000
          initialDelaySeconds: 60
          periodSeconds: 20
        readinessProbe:
          httpGet:
            path: /.well-known/apollo/server-health
            port: 4000
          initialDelaySeconds: 15
          periodSeconds: 10
---
# Source: social-network/templates/deployments/kafka-consumers-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-kafka-consumers
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: kafka-consumers
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: kafka-consumers
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: kafka-consumers
    spec:
      containers:
      - name: kafka-consumers
        image: rania290/projet-micro-kafka-consumers-notifications:local
        imagePullPolicy: IfNotPresent
        env:
        - name: KAFKA_BROKERS
          value: "social-network-kafka:9092"
        - name: MONGODB_URI
          value: "mongodb://admin:password@social-network-mongodb:27017/social-network?authSource=admin"
        resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        livenessProbe:
          exec:
            command:
            - node
            - -e
            - "console.log('Health check')"
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          exec:
            command:
            - node
            - -e
            - "console.log('Readiness check')"
          initialDelaySeconds: 15
          periodSeconds: 10
---
# Source: social-network/templates/deployments/kafka-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-kafka
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: kafka
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: kafka
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: kafka
    spec:
      containers:
      - name: kafka
        image: confluentinc/cp-kafka:7.5.0
        ports:
        - containerPort: 9092
        env:
        - name: KAFKA_ZOOKEEPER_CONNECT
          value: "social-network-zookeeper:2181"
        - name: KAFKA_ADVERTISED_LISTENERS
          value: "PLAINTEXT://social-network-kafka:9092"
        - name: KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR
          value: "1"
        - name: KAFKA_AUTO_CREATE_TOPICS_ENABLE
          value: "true"
        volumeMounts:
        - name: kafka-storage
          mountPath: /var/lib/kafka/data
        resources:
          null
        livenessProbe:
          tcpSocket:
            port: 9092
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          tcpSocket:
            port: 9092
          initialDelaySeconds: 5
          periodSeconds: 5
      - name: kafka-exporter
        image: danielqsj/kafka-exporter:latest
        args:
          - --kafka.server=127.0.0.1:9092
        ports:
        - containerPort: 9308
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
      volumes:
      - name: kafka-storage
        persistentVolumeClaim:
          claimName: social-network-kafka-pvc
---
# Source: social-network/templates/deployments/mongodb-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-mongodb
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: mongodb
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: mongodb
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: mongodb
    spec:
      containers:
      - name: mongodb
        image: mongo:6.0
        ports:
        - containerPort: 27017
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          value: admin
        - name: MONGO_INITDB_ROOT_PASSWORD
          value: password
        - name: MONGO_INITDB_DATABASE
          value: social-network
        volumeMounts:
        - name: mongodb-storage
          mountPath: /data/db
        resources:
          limits:
            cpu: 1000m
            memory: 1Gi
          requests:
            cpu: 500m
            memory: 512Mi
        livenessProbe:
          exec:
            command:
              - mongosh
              - --eval
              - "db.adminCommand('ping')"
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          exec:
            command:
              - mongosh
              - --eval
              - "db.adminCommand('ping')"
          initialDelaySeconds: 5
          periodSeconds: 5
      - name: mongodb-exporter
        image: percona/mongodb_exporter:0.39
        ports:
        - containerPort: 9216
        env:
        - name: MONGODB_URI
          value: mongodb://admin:password@127.0.0.1:27017/social-network?authSource=admin
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
      volumes:
      - name: mongodb-storage
        persistentVolumeClaim:
          claimName: social-network-mongodb-pvc
      - name: mongodb-pvc
        persistentVolumeClaim:
          claimName: social-network-mongodb-pvc
---
# Source: social-network/templates/deployments/posts-service-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-posts-service
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: posts-service
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: posts-service
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: posts-service
    spec:
      containers:
      - name: posts-service
        image: rania290/projet-micro-posts-service:local
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 3020
        env:
        - name: MONGODB_URI
          value: "mongodb://admin:password@social-network-mongodb:27017/social-network?authSource=admin"
        - name: KAFKA_BROKERS
          value: "social-network-kafka:9092"
        - name: POSTS_SERVICE_PORT
          value: "3020"
        resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        livenessProbe:
          httpGet:
            path: /posts
            port: 3020
          initialDelaySeconds: 60
          periodSeconds: 20
        readinessProbe:
          httpGet:
            path: /posts
            port: 3020
          initialDelaySeconds: 15
          periodSeconds: 10
---
# Source: social-network/templates/deployments/prometheus-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-prometheus
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: prometheus
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: prometheus
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: prometheus
    spec:
      serviceAccountName: social-network-prometheus
      containers:
      - name: prometheus
        image: prom/prometheus:v2.45.0
        ports:
        - containerPort: 9090
        volumeMounts:
        - name: prometheus-config
          mountPath: /etc/prometheus/prometheus.yml
          subPath: prometheus.yml
        - name: prometheus-storage
          mountPath: /prometheus
        resources:
          limits:
            cpu: 200m
            memory: 512Mi
          requests:
            cpu: 100m
            memory: 256Mi
        livenessProbe:
          httpGet:
            path: /-/healthy
            port: 9090
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /-/ready
            port: 9090
          initialDelaySeconds: 5
          periodSeconds: 5
      volumes:
      - name: prometheus-config
        configMap:
          name: social-network-prometheus-config
      - name: prometheus-storage
        emptyDir: {}
---
# Source: social-network/templates/deployments/zookeeper-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: social-network-zookeeper
  labels:
    helm.sh/chart: social-network-0.1.0
    app.kubernetes.io/name: social-network
    app.kubernetes.io/instance: social-network
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: zookeeper
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: social-network
      app.kubernetes.io/instance: social-network
      app.kubernetes.io/component: zookeeper
  template:
    metadata:
      labels:
        app.kubernetes.io/name: social-network
        app.kubernetes.io/instance: social-network
        app.kubernetes.io/component: zookeeper
    spec:
      containers:
      - name: zookeeper
        image: confluentinc/cp-zookeeper:7.5.0
        ports:
        - containerPort: 2181
        env:
        - name: ZOOKEEPER_CLIENT_PORT
          value: "2181"
        - name: ZOOKEEPER_TICK_TIME
          value: "2000"
        volumeMounts:
        - name: zookeeper-storage
          mountPath: /var/lib/zookeeper/data
        resources:
          null
        livenessProbe:
          tcpSocket:
            port: 2181
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          tcpSocket:
            port: 2181
          initialDelaySeconds: 5
          periodSeconds: 5
      volumes:
      - name: zookeeper-storage
        persistentVolumeClaim:
          claimName: social-network-zookeeper-pvc
